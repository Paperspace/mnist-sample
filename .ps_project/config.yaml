version: 2
workflows:
  testwf:
    steps:
      - name: testexp
        triggers:
          tags:
            only: "v.*"
          branches:
            only: ".*"
        command: experiment.run_multi_node
        checks:
          tensorflow:loss:
            target: 0.0..1.0
            aggregate: max
          tensorflow:accuracy:
            target: 0.988..1.000
            aggregate: median
          defaults:
            precision: 3
        params:
          name: testexp
          experimentType: "multi-grpc"
          projectHandle: pr9apiw3w
          ports: "5000"
          parameterServerContainer: "tensorflow/tensorflow:1.13.1-py3"
          parameterServerCommand: "pip install -r requirements.txt && python mnist.py"
          parameterServerMachineType: "G1"
          parameterServerCount: 1
          workerContainer: "tensorflow/tensorflow:1.13.1-gpu-py3"
          workerCommand: "pip install -r requirements.txt && python mnist.py"
          workerMachineType: "K80"
          workerCount: 2
          modelType: Tensorflow
          modelPath: "/artifacts"
